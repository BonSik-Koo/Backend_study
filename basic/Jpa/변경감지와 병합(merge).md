준영속 엔티티?
====================
> 영속성 컨텍스트가 더이상 관리하지 않는 엔티티를 말한다. - 영속성 컨텍스트가 지원하는 기능을 사용할수 없음

* 준영속 엔티티를 수정한는 2가지 방법
  * 변경 감지 기능 사용
  * 병합(merge) 사용

📌변경 감지
-----------------------------
> - 영속성 컨텍스트에서 엔티티를 다시 조회한후(없으시 DB에 찾고 영속성 컨텍스트로 올림) 데이터를 수정하는 방법
> - 트랜잭션 내에서 엔티티를 조회후 값 변경하게 되면 **트렌젝션 커밋** 시점에서 **변경감지(Dirty Checking)** 이 동작하여 DB로 UPDATE SQL문이 전송된다. 




📌병합(merge)
-------------------
> 준영속 상태의 엔티티를 영속 상태로 변경할때 사용하는 기능(em.merge())

* 동작 방식
  > ![image](https://user-images.githubusercontent.com/96917871/179481398-bd90e2a1-5147-4310-a36a-e776ef67daab.png)
  1. 준영속 엔티티(파라미터로 넘어온)의 식별자(id)값으로 영속 엔티티를 조회함 , 만약 1차 캐시에 엔티티가 없으면 데이터베이스에서 엔티티를 조회하고, 1차 캐시에 저장한다.
  2. 위에서 찾은 영속 컨텍스트의 엔티티 값을 준영속 엔티티 값으로 **모두** 교체한다.
     > 모두 교체하는 것이 핵심이다. DB에 찾은 영속컨텍스트에 엔티티에 모든 필드에 값이 있었지만 만약 준영속 엔티티의 값이 없는(null) 필드가 있다면 준영속 엔티티의 값으로 모두 변경됨
  3. 트랜잭션 커밋 시점에서 변경감지기능이 동작하여 DB로 UPDATE SQL문이 전송된다.


❗주의
-----------------------
> - 두 방식모두 결국 변경 감지 기능을 사용한다.
> - **변경 감지** 기능은 원하는 필드(속성)만 선택해서 변경할수 있지만, **병합** 은 모든 속성의 값이 변경된다. 병합시 값이 없으면 null로 업데이트 될 위험이 있다.(병합은 모든 필드를 교체한다.)
> - **최대한 항상 변경 감지**를 사용하기
